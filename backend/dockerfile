# 使用輕量化的 Alpine 版本，減少映像檔體積 (從 ~1GB 降到 ~100MB)
FROM node:18-alpine

# 設定工作目錄
WORKDIR /usr/src/app

# 設定環境變數為生產模式 (提升效能，不安裝 devDependencies)
ENV NODE_ENV=production

# 複製 package.json 和 package-lock.json
COPY package*.json ./

# 使用 npm ci (Clean Install) 取代 npm install，確保版本一致且速度更快
RUN npm ci --only=production

# 複製程式碼
COPY . .

# Cloud Run 預設會注入 PORT=8080，這裡宣告一下
ENV PORT=8080
EXPOSE 8080

# 啟動應用
# 注意：請確保 src/server.js 裡有寫 const port = process.env.PORT || 3000;
CMD [ "node", "src/server.js" ]